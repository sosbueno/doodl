<!DOCTYPE html>
<html data-theme="">
    <script>
        // Prevent browser extensions from injecting ethereum/Web3 code
        // This prevents the "Cannot redefine property: ethereum" error
        if (typeof window.ethereum === 'undefined') {
          try {
            Object.defineProperty(window, 'ethereum', {
              value: undefined,
              writable: false,
              configurable: false
            });
          } catch (e) {
            // Ignore if already defined
          }
        }
        
        // Handle room code from URL (e.g., ?UsCN6Pnv)
        // Store it for the Play button to use, but DON'T auto-join
        (function() {
          const urlParams = new URLSearchParams(window.location.search);
          const roomCode = urlParams.get('room') || Array.from(urlParams.keys()).find(key => key.length === 8 && /^[A-Za-z0-9]+$/.test(key));
          if (roomCode) {
            window._roomCodeFromUrl = roomCode;
            window._joinRoomCode = roomCode;
            // NO auto-join - user should click Play button to join
          }
          
          // Check if user was kicked/banned - game.js will handle showing the modal
          // We don't need to do anything here since we're using localStorage
          // and redirecting without query parameters
        })();
        
        // Ad-related code removed
    </script>
    <head>
        <title>doodl - Free Multiplayer Drawing &amp;Guessing Game</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0 user-scalable=yes">
        <meta name="description" content="doodl is a free multiplayer drawing and guessing game. Draw and guess words with your friends and people all around the world! Score the most points and be the winner!">
        <meta name="keywords" content="doodl, doodls, doodls.fun, doodl coin, drawing, paint, draw, guess, draw and guess, drawmything, fun, points, score, winner, browser, free, friends">
        <meta name="robots" content="index">
        <meta http-equiv="content-language" content="en">
        <meta property="og:type" content="website">
        <meta property="og:title" content="doodl - Free Multiplayer Drawing &amp; Guessing Game">
        <meta property="og:url" content="https://doodls.fun/">
        <meta property="og:description" content="doodl is a free multiplayer drawing and guessing game. Draw and guess words with your friends and people all around the world! Score the most points and be the winner!">
        <meta property="og:site_name" content="doodl - Free Multiplayer Drawing &amp; Guessing Game">
        <meta property="og:image" content="https://doodls.fun/img/banner.png?v=2">
        <meta property="og:image:width" content="800">
        <meta property="og:image:height" content="600">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="doodl - Free Multiplayer Drawing &amp; Guessing Game">
        <meta name="twitter:description" content="doodl is a free multiplayer drawing and guessing game. Draw and guess words with your friends and people all around the world! Score the most points and be the winner!">
        <meta name="twitter:image" content="https://doodls.fun/img/banner.png?v=2">
        <link rel="icon" type="image/png" href="img/fulllogo.png">
        <link rel="shortcut icon" type="image/png" href="img/fulllogo.png">
        <link rel="apple-touch-icon" href="img/fulllogo.png">
        <svg style="position: absolute; width: 0; height: 0;" aria-hidden="true" focusable="false">
            <defs>
                <filter id="remove-white-outline" x="-50%" y="-50%" width="200%" height="200%">
                    <feColorMatrix type="matrix" in="SourceGraphic" values="
                        1.2 0 0 0 0.1
                        0 1.2 0 0 0.1
                        0 0 1.2 0 0.1
                        0 0 0 1 0
                    " result="brightened"/>
                    <feComponentTransfer in="brightened">
                        <feFuncA type="gamma" amplitude="1.1" exponent="0.9" offset="0"/>
                    </feComponentTransfer>
                </filter>
            </defs>
        </svg>
        <link rel="stylesheet" type="text/css" href="css/style.css" title="stylesheet">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inconsolata&amp;display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,400;0,600;0,700;0,800;1,400&amp;display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    </head>
    <body translate="no">
        <div id="preroll"></div>
        <div id="home">
            <div class="home-header">
                <div class="logo-big">
                    <a href="/" class="logo-link">
                        <img src="/img/fulllogo.png">
                    </a>
                    <div class="avatar-container"></div>
                </div>
            </div>
            <div class="home-main">
                <div class="game-panel-wrapper">
                    <div class="panel game-panel">
                        <div class="container-name-lang">
                            <input class="input-name" type="text" spellcheck="false" autocomplete="off" placeholder="Enter your name" maxlength="16" data-translate="placeholder">
                            <select disabled>
                                <option value="0" selected>English</option>
                            </select>
                        </div>
                        <div class="avatar-customizer">
                            <div class="arrows left">
                                <div class="arrow left" data-avatar-index="1"></div>
                                <div class="arrow left" data-avatar-index="2"></div>
                                <div class="arrow left" data-avatar-index="0"></div>
                            </div>
                            <div class="container"></div>
                            <div class="arrows right">
                                <div class="arrow right" data-avatar-index="1"></div>
                                <div class="arrow right" data-avatar-index="2"></div>
                                <div class="arrow right" data-avatar-index="0"></div>
                            </div>
                            <div class="randomize" data-tooltip="Randomize your Avatar!" data-tooltipdir="N"></div>
                        </div>
                        <button class="button-play">
                            <span data-translate="text">Play!</span>
                        </button>
                        <button class="button-create">
                            <span data-translate="text">Create Private Room</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="bottom">
                <svg viewBox="0 0 1 1" preserveAspectRatio="none">
                    <polygon points="0,0 1,1 0,1"></polygon>
                </svg>
                <div class="footer">
                    <div class="section-container">
                        <div class="section panel">
                            <img class="icon" src="/img/about.gif">
                            <h2 data-translate="text">About</h2>
                            <span data-translate="text"><a href="/" class="doodl-link"><b>doodls.fun</b></a> is a free online multiplayer drawing and guessing pictionary game. Players take turns drawing words while others guess to earn points. The player with the most points wins!</span>
                            <br>
                            <span data-translate="text">100% of creator fees from the $doodl coin go directly into prize pools for games. Play for free and compete for prizes!</span>
                            <br>
                            <span data-translate="text">Have fun!</span>
                        </div>
                        <div class="section panel">
                            <img class="icon" src="/img/news.gif">
                            <h2 data-translate="text">Updates</h2>
                            <div class="news">
                                <div class="head">
                                    <div class="title">New Features Coming Soon</div>
                                    <div class="date"></div>
                                </div>
                                <div class="content">
                                    <span data-translate="text">We're working on exciting new features! Stay tuned for updates.</span>
                                </div>
                            </div>
                        </div>
                        <div class="section panel">
                            <img class="icon" src="/img/how.gif">
                            <h2 data-translate="text">How to play</h2>
                            <div id="tutorial">
                                <div class="pages">
                                    <div class="page">
                                        <img src="/img/tutorial/step1.gif">
                                        <div class="description" data-translate="text">When it's your turn, choose a word you want to draw!</div>
                                    </div>
                                    <div class="page">
                                        <img src="/img/tutorial/step2.gif">
                                        <div class="description" data-translate="text">Try to draw your choosen word! No spelling!</div>
                                    </div>
                                    <div class="page">
                                        <img src="/img/tutorial/step3.gif">
                                        <div class="description" data-translate="text">Let other players try to guess your drawn word!</div>
                                    </div>
                                    <div class="page">
                                        <img src="/img/tutorial/step4.gif">
                                        <div class="description" data-translate="text">When it's not your turn, try to guess what other players are drawing!</div>
                                    </div>
                                    <div class="page">
                                        <img src="/img/tutorial/step5.gif">
                                        <div class="description" data-translate="text">Score the most points and be crowned the winner at the end!</div>
                                    </div>
                                </div>
                                <div class="navigation"></div>
                            </div>
                        </div>
                    </div>
                    <div class="tos">
                        <a href="/terms">Terms</a>
                        <a href="/privacy">Privacy</a>
                        <a href="/faq">FAQ</a>
                        <a href="#" id="support-link" class="support-link">Support</a>
                        <a href="https://x.com/doodlsdotfun" target="_blank" rel="noopener noreferrer" class="x-link" title="Follow us on X">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                    </div>
                    <div class="notice">The owner of this site is not responsible for any user generated content (drawings, messages, usernames)</div>
                </div>
            </div>
        </div>
        <div id="game" style="display:none">
            <div id="game-wrapper">
                <div id="game-logo">
                    <a href="/">
                        <img src="/img/fulllogo.png">
                    </a>
                    <div class="ad-1">
                        <!-- Ad removed -->
                    </div>
                </div>
                <div id="game-bar">
                    <div id="game-settings" data-tooltip="Volume" data-tooltipdir="W">
                        <div class="icon"></div>
                        <div class="mute-line"></div>
                    </div>
                    <div id="game-clock">
                        <div class="text"></div>
                    </div>
                    <div id="game-round">
                        <div class="text"></div>
                    </div>
                    <div id="game-word">
                        <div class="description">DRAW THIS</div>
                        <div class="word"></div>
                        <div class="hints">
                            <div class="container"></div>
                        </div>
                    </div>
                </div>
                <div id="game-players">
                    <div class="players-list"></div>
                </div>
                <div id="game-players-footer"></div>
                <div id="game-chat-input-mobile">
                    <form class="chat-form">
                        <input type="text" autocomplete="off" placeholder="Type your guess here..." maxlength="100" data-translate="placeholder">
                        <div class="characters"></div>
                    </form>
                </div>
                <div id="game-canvas">
                    <canvas width="800" height="600"></canvas>
                    <div class="overlay"></div>
                    <div class="overlay-content">
                        <div class="text"></div>
                        <div class="words"></div>
                        <div class="reveal">
                            <p>
                                <span data-translate="text">The word was</span>
                                <span class="word"></span>
                            </p>
                            <div class="reason"></div>
                            <div class="player-container"></div>
                        </div>
                        <div class="result">
                            <div class="message">
                                <b class="winner-name"></b>
                                <span class="winner-text"></span>
                            </div>
                            <div class="podests">
                                <div class="podest-1"></div>
                                <div class="podest-2"></div>
                                <div class="podest-3"></div>
                            </div>
                            <div class="ranks"></div>
                        </div>
                        <div class="room">
                            <div class="group-settings">
                                <div class="key">
                                    <img src="/img/setting_1.gif">
                                    <span data-translate="text">Players</span>
                                </div>
                                <div class="value">
                                    <select id="item-settings-slots" data-setting="1">
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5</option>
                                        <option>6</option>
                                        <option>7</option>
                                        <option>8</option>
                                        <option>9</option>
                                        <option>10</option>
                                        <option>11</option>
                                        <option>12</option>
                                        <option>13</option>
                                        <option>14</option>
                                        <option>15</option>
                                        <option>16</option>
                                        <option>17</option>
                                        <option>18</option>
                                        <option>19</option>
                                        <option>20</option>
                                    </select>
                                </div>
                                <div class="key">
                                    <img src="/img/setting_0.gif">
                                    <span data-translate="text">Language</span>
                                </div>
                                <div class="value">
                                    <select id="item-settings-language" data-setting="0" disabled>
                                        <option value="0" selected>English</option>
                                    </select>
                                </div>
                                <div class="key">
                                    <img src="/img/setting_2.gif">
                                    <span data-translate="text">Drawtime</span>
                                </div>
                                <div class="value">
                                    <select id="item-settings-drawtime" data-setting="2">
                                        <option>15</option>
                                        <option>20</option>
                                        <option>30</option>
                                        <option>40</option>
                                        <option>50</option>
                                        <option>60</option>
                                        <option>70</option>
                                        <option>80</option>
                                        <option>90</option>
                                        <option>100</option>
                                        <option>120</option>
                                        <option>150</option>
                                        <option>180</option>
                                        <option>210</option>
                                        <option>240</option>
                                    </select>
                                </div>
                                <div class="key">
                                    <img src="/img/setting_3.gif">
                                    <span data-translate="text">Rounds</span>
                                </div>
                                <div class="value">
                                    <select id="item-settings-rounds" data-setting="3">
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5</option>
                                        <option>6</option>
                                        <option>7</option>
                                        <option>8</option>
                                        <option>9</option>
                                        <option>10</option>
                                    </select>
                                </div>
                                <div class="key">
                                    <img src="/img/setting_6.gif">
                                    <span data-translate="text">Game Mode</span>
                                </div>
                                <div class="value">
                                    <select id="item-settings-mode" data-setting="6" data-translate="children">
                                        <option value="0">Normal</option>
                                        <option value="1">Hidden</option>
                                        <option value="2">Combination</option>
                                    </select>
                                </div>
                                <div class="key">
                                    <img src="/img/setting_4.gif">
                                    <span data-translate="text">Word Count</span>
                                </div>
                                <div class="value">
                                    <select id="item-settings-wordcount" data-setting="4">
                                        <option>1</option>
                                        <option>2</option>
                                        <option selected>3</option>
                                        <option>4</option>
                                        <option>5</option>
                                        <option>6</option>
                                    </select>
                                </div>
                                <div class="key">
                                    <img src="/img/setting_5.gif">
                                    <span data-translate="text">Hints</span>
                                </div>
                                <div class="value">
                                    <select id="item-settings-hints" data-setting="5">
                                        <option>0</option>
                                        <option>1</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5</option>
                                    </select>
                                </div>
                            </div>
                            <div class="group-customwords">
                                <div class="game-room-name">
                                    <div data-translate="text">Custom words</div>
                                    <div class="game-room-checkbox">
                                        <label for="item-settings-customwordsonly" data-translate="text">Use custom words only</label>
                                        <input id="item-settings-customwordsonly" type="checkbox" data-setting="7">
                                    </div>
                                </div>
                                <textarea id="item-settings-customwords" maxlength="20000" spellcheck="false" placeholder="Minimum of 10 words. 1-32 characters per word! 20000 characters maximum. Separated by a , (comma)"></textarea>
                            </div>
                            <div class="group-buttons">
                                <button id="button-start-game">
                                    <span data-translate="text">Start!</span>
                                </button>
                                <button id="button-invite">
                                    <img src="/img/link.svg">
                                    <span data-translate="text">Invite</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div id="game-rate">
                        <div class="like"></div>
                        <div class="dislike"></div>
                    </div>
                    <div class="bubbles"></div>
                </div>
                <div id="game-toolbar">
                    <div class="color-preview-mobile"></div>
                    <div class="color-preview">
                        <svg id="color-preview-primary" viewbox="0 0 1 1">
                            <polygon points="0,0 0,1 1,1 1,0"></polygon>
                        </svg>
                        <svg id="color-preview-secondary" viewbox="0 0 1 1">
                            <polygon points="0.85,0 1,0 1,1 0.15,1"></polygon>
                        </svg>
                    </div>
                    <div class="colors" data-tooltip="Left-/Rightclick to choose a color!" data-tooltipdir="S"></div>
                    <div class="sizes" data-tooltip="Click to change brush size!" data-tooltipdir="S">
                        <div class="size-preview clickable">
                            <div class="icon"></div>
                        </div>
                        <div class="container">
                            <div class="arrow"></div>
                        </div>
                    </div>
                    <div class="toolbar-group-tools"></div>
                    <div class="toolbar-group-actions"></div>
                </div>
                <div id="game-chat">
                    <div class="ad-2">
                        <!-- Ad removed -->
                    </div>
                    <div class="chat-content"></div>
                    <form class="chat-form">
                        <input type="text" autocomplete="off" placeholder="Type your guess here..." maxlength="100" data-translate="placeholder">
                        <div class="characters"></div>
                    </form>
                </div>
            </div>
            <div id="game-keyboard">
                <div class="keyboard-wrapper">
                    <div class="keys"></div>
                </div>
            </div>
        </div>
        <div id="load">
            <div class="container">
                <div class="icon">
                    <div class="graphic"></div>
                </div>
            </div>
        </div>
        <div id="modal">
            <div class="modal-wrapper">
                <div class="modal-container">
                    <div class="modal-title">
                        <div class="text"></div>
                        <div class="close">&times;</div>
                    </div>
                    <div class="modal-content">
                        <div class="modal-container-info">
                            <div class="message"></div>
                            <button class="ok">Okay!</button>
                        </div>
                        <div class="modal-container-player">
                            <div class="player"></div>
                            <div class="buttons">
                                <div class="button-pair">
                                    <button class="kick" data-translate="text">Kick</button>
                                    <button class="ban" data-translate="text">Ban</button>
                                </div>
                                <button class="votekick" data-translate="text">Votekick</button>
                                <button class="mute">Mute</button>
                                <button class="report" data-translate="text">Report</button>
                            </div>
                            <div class="report-menu">
                                <div class="description" data-translate="text">Please select the reasons for your report</div>
                                <div class="row">
                                    <label data-translate="text" for="report-reason-toxic">Inappropriate Messages / Drawings</label>
                                    <input type="checkbox" id="report-reason-toxic">
                                </div>
                                <div class="row">
                                    <label data-translate="text" for="report-reason-spam">Spam</label>
                                    <input type="checkbox" id="report-reason-spam">
                                </div>
                                <div class="row">
                                    <label data-translate="text" for="report-reason-bot">Botting / Cheating</label>
                                    <input type="checkbox" id="report-reason-bot">
                                </div>
                                <button data-translate="text" id="report-send">Report</button>
                            </div>
                            <div class="invite">
                                <div class="text" data-translate="text">Invite your friends!</div>
                                <button data-translate="text" id="modal-player-button-invite">Click to copy Invite</button>
                            </div>
                        </div>
                        <div class="modal-container-room">
                            <div id="game-invite">
                                <div class="input-container">
                                    <input type="text" readonly id="input-invite">
                                    <div class="link-overlay">
                                        <span data-translate="text">Hover over me to see the invite link!</span>
                                    </div>
                                </div>
                                <button id="copy-invite">
                                    <span data-translate="text">Copy</span>
                                </button>
                            </div>
                        </div>
                        <div class="modal-container-settings">
                            <div class="group" id="volume">
                                <div class="title">
                                    <div class="icon volume"></div>
                                    <div class="desc" data-translate="text">Volume</div>
                                    <div class="volume-value">0%</div>
                                </div>
                                <div class="item"><input type="range" min="0" max="100"></div>
                            </div>
                            <div class="group">
                                <div class="title">
                                    <div class="icon hotkeys"></div>
                                    <div class="desc" data-translate="text">Hotkeys</div><button class="reset" data-translate="text" data-tooltip="Reset hotkeys to default" data-tooltipdir="N">Reset</button></div>
                                <div id="hotkey-list"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script src="js/socket.io.js"></script>
        <script>
        // Handle Support link - opens Google Form (placeholder for now)
        document.addEventListener('DOMContentLoaded', function() {
            const supportLink = document.getElementById('support-link');
            if (supportLink) {
                supportLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    // TODO: Replace with actual Google Form URL
                    const googleFormUrl = 'https://forms.google.com/your-form-id-here';
                    window.open(googleFormUrl, '_blank', 'noopener,noreferrer');
                });
            }
        });
        </script>
        <script>
        // Minimal fixes to work with our server
  (function() {
          'use strict';
          
          // Stub aiptag to prevent errors
          // Ad-related code removed
          
          // Patch URL constructor to handle room IDs
          const OriginalURL = window.URL;
          window.URL = function(input, base) {
            try {
              return new OriginalURL(input, base);
            } catch(e) {
              return new OriginalURL(location.origin);
            }
          };
          window.URL.createObjectURL = OriginalURL.createObjectURL;
          window.URL.revokeObjectURL = OriginalURL.revokeObjectURL;
          
          // Patch XMLHttpRequest to fix /api/play response
          const OriginalXHR = window.XMLHttpRequest;
          window.XMLHttpRequest = function() {
            const xhr = new OriginalXHR();
            let _requestUrl = null;
            let _parsedResponse = null;
            
            const originalOpen = xhr.open;
            xhr.open = function(method, url) {
              _requestUrl = url;
              return originalOpen.apply(this, arguments);
            };
            
            const originalSend = xhr.send;
            xhr.send = function(data) {
              // If we have a room code from URL, append it to the request
              if (_requestUrl && _requestUrl.includes('/api/play') && window._joinRoomCode) {
                const originalData = data || '';
                const roomCodeParam = '&roomCode=' + encodeURIComponent(window._joinRoomCode);
                data = originalData + (originalData ? roomCodeParam : roomCodeParam.substring(1));
              }
              
              const originalOnReadyStateChange = xhr.onreadystatechange;
              xhr.onreadystatechange = function() {
                if (this.readyState === 4 && _requestUrl && _requestUrl.includes('/api/play')) {
                  if (this.status === 200) {
                    try {
                      const response = JSON.parse(this.responseText);
                      if (response.success) {
                        window._lastApiRoomId = response.roomId;
                        if (!response.data || typeof response.data !== 'string') {
                          response.data = location.origin;
                        }
                        _parsedResponse = response;
              }
            } catch(e) {
                      console.error('❌ Error parsing API response:', e);
                    }
                  } else {
                    console.error('❌ API request failed:', this.status, this.statusText);
                    const loadScreen = document.getElementById('load');
                    if (loadScreen) {
                      loadScreen.style.display = 'none';
                    }
            }
          }
          if (originalOnReadyStateChange) {
                  return originalOnReadyStateChange.apply(this, arguments);
          }
        };
              return originalSend.apply(this, arguments);
    };
            
            Object.defineProperty(xhr, 'response', {
              get: function() {
                if (_parsedResponse && this.readyState === 4 && _requestUrl && _requestUrl.includes('/api/play')) {
                  return _parsedResponse.data;
                }
                const originalDesc = Object.getOwnPropertyDescriptor(OriginalXHR.prototype, 'response');
                return originalDesc?.get?.call(this) || null;
              },
              configurable: true
            });
            
            return xhr;
          };
      
          // Track which button was clicked and show loading screen
          document.addEventListener('click', function(e) {
            const button = e.target.closest('.button-play, .button-create');
            if (button) {
              // Store which button was clicked
              window._isCreateButton = button.classList.contains('button-create');
              
              const loadScreen = document.getElementById('load');
              if (loadScreen) {
                loadScreen.style.display = 'block';
                loadScreen.style.visibility = 'visible';
                loadScreen.style.opacity = '1';
                loadScreen.style.zIndex = '9999';
              }
            }
          }, true);
          
          // Patch Socket.IO to inject roomId and fix HTTPS/WSS issues
          const originalIo = window.io;
          if (originalIo) {
            window.io = function(url, options) {
              let actualUrl = url;
              
              // Handle different URL formats
              if (typeof url === 'object' && url !== null && url.data) {
                actualUrl = url.data;
              } else if (typeof url !== 'string' || !url.match(/^https?:\/\//)) {
                actualUrl = location.origin;
              }
              
              // Always use current page's origin on Render (simplest approach)
              if (location.hostname && (location.hostname.includes('onrender.com') || location.hostname.includes('doodls.fun'))) {
                actualUrl = location.origin; // Use current page's origin (already HTTPS)
              } else {
                // For localhost, use the URL as-is but fix malformed ones
                if (location.protocol === 'https:') {
                  actualUrl = actualUrl.replace(/^http:\/\//, 'https://');
                }
                // Fix malformed URLs (http:/ or https:/)
                actualUrl = actualUrl.replace(/^(https?):\/([^/])/, '$1://$2');
              }
              
              // Remove trailing slashes
              actualUrl = actualUrl.replace(/\/$/, '');
              
              // Ensure options object exists
              if (!options) {
                options = {};
              }
              
              // CRITICAL: Set explicit path to prevent double slashes
              options.path = '/socket.io/';
              
              // Force secure transport on HTTPS
              if (location.protocol === 'https:') {
                options.secure = true;
                options.transports = ['websocket', 'polling'];
      }
      
              
              // Show loading screen when Socket.IO connects
              const loadScreen = document.getElementById('load');
              if (loadScreen) {
                loadScreen.style.display = 'block';
                loadScreen.style.visibility = 'visible';
                loadScreen.style.opacity = '1';
                loadScreen.style.zIndex = '9999';
              }
              
              const socket = originalIo.call(this, actualUrl, options);
              
              // Make socket globally available for game.js
              window.S = socket;
              window.socket = socket;
              
              // Track if GAME_DATA was received
              let gameDataReceived = false;
              
              // Fallback: Force transition after 10 seconds if no GAME_DATA (longer timeout for Render)
              const fallbackTimeout = setTimeout(function() {
                if (!gameDataReceived) {
                  console.warn('⚠️ No GAME_DATA received after 10s - forcing transition');
                  const loadScreen = document.getElementById('load');
                  if (loadScreen) {
                    loadScreen.style.display = 'none';
                    loadScreen.style.visibility = 'hidden';
                    loadScreen.style.opacity = '0';
                  }
                  const home = document.getElementById('home');
                  const game = document.getElementById('game');
                  if (home && game) {
                    home.style.cssText = 'display: none !important; visibility: hidden !important; opacity: 0 !important;';
                    game.style.cssText = 'display: flex !important; visibility: visible !important; opacity: 1 !important;';
            }
                }
              }, 10000);
              
              // Log connection events
              socket.on('connect', function() {
              });
              
              socket.on('connect_error', function(error) {
                console.error('❌ Socket.IO connection error:', error);
                const loadScreen = document.getElementById('load');
                if (loadScreen) {
                  loadScreen.style.display = 'none';
                }
              });
              
              socket.on('disconnect', function() {
              });
              
              const originalEmit = socket.emit;
              socket.emit = function(event, data) {
                if (event === 'login' && data) {
                  // If Create Private Room button was clicked, set create flag and don't set join
                  if (window._isCreateButton) {
                    data.create = 1;
                    data.join = undefined; // Don't join existing room, create new one
                    data.code = undefined; // Don't use code from API
                    // Clear the flag after use
                    window._isCreateButton = false;
                  } else if (window._joinRoomCode) {
                    // User opened invite link - join that specific room
                    data.join = window._joinRoomCode;
                    data.code = window._joinRoomCode;
                    data.create = 0; // Don't create, join existing
                  } else if (window._lastApiRoomId) {
                    // Normal join - use API room ID
                    data.join = window._lastApiRoomId;
                    data.code = window._lastApiRoomId;
                  }
                }
                return originalEmit.apply(this, arguments);
              };
              
              // Handle page transitions and private room display
              socket.on('data', function(data) {
                if (data && data.id === 10) { // GAME_DATA packet
                  gameDataReceived = true;
                  clearTimeout(fallbackTimeout);
                  
                  // Hide loading screen (reduced delay for faster transition like localhost)
                  setTimeout(function() {
                    const loadScreen = document.getElementById('load');
                    if (loadScreen) {
                      loadScreen.style.display = 'none';
                      loadScreen.style.visibility = 'hidden';
                      loadScreen.style.opacity = '0';
                    }
                    
                    // Transition to game screen immediately
                    const home = document.getElementById('home');
                    const game = document.getElementById('game');
                    if (home && game) {
                      home.style.cssText = 'display: none !important; visibility: hidden !important; opacity: 0 !important;';
                      game.style.cssText = 'display: flex !important; visibility: visible !important; opacity: 1 !important;';
                    }
                  }, 800);
                  
                  // Store room code immediately when GAME_DATA received
                  if (data.data) {
                    window._roomCode = data.data.code || data.data.id;
                    window._roomId = data.data.id;
                    
                    // Patch invite functionality to use our domain and room code
                    // Wait for game.js to initialize first, then patch continuously
                    function patchInviteButtons() {
                      // No longer needed - game.js now uses location.origin directly
                      // Just ensure old URLs are replaced if they somehow appear
                      const inviteInput = document.querySelector('#input-invite');
                      if (inviteInput) {
                        // Only patch if we see an old URL
                        const currentValue = inviteInput.value || inviteInput.getAttribute('value') || '';
                        if (currentValue && (currentValue.includes('skribbl.io') || currentValue.includes('doodls.fun'))) {
                          // Extract room code from the URL
                          const match = currentValue.match(/[?&]([A-Za-z0-9]{8})/);
                          if (match && match[1]) {
                            inviteInput.value = location.origin + '/?' + match[1];
                          } else if (window._roomCode) {
                            inviteInput.value = location.origin + '/?' + window._roomCode;
                          }
                        }
                      }
                      
                      // Patch invite buttons to use our domain and show chat message
                      // The official game.js adds click handlers, so we need to intercept them
                      const inviteBtns = document.querySelectorAll('#button-invite, #modal-player-button-invite');
                      inviteBtns.forEach(function(inviteBtn) {
                        if (inviteBtn) {
                          // Remove any existing patched handler (check for our marker)
                          if (inviteBtn._patchedInvite) return;
                          inviteBtn._patchedInvite = true;
                          
                          // Add our handler (runs first in capture phase)
                          inviteBtn.addEventListener('click', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            e.stopImmediatePropagation();
                            
                            // Use stored room code directly (should always be available)
                            const roomCode = window._roomCode || window._roomId;
                            if (!roomCode) {
                              console.error('❌ Room code not available');
                              return false;
                            }
                            
                            copyInviteLink(roomCode);
                            return false;
                          }, true);
                        }
                      });
                      
                      function copyInviteLink(code) {
                        const inviteUrl = location.origin + '/?' + code;
                        
                        // Show chat message (like official game.js does)
                        // Access game.js's y function if available, otherwise create our own
                        if (window.game && typeof window.game.y === 'function') {
                          // Use game.js's chat function
                          window.game.y("Copied room link to clipboard!", "", "var(--COLOR_CHAT_TEXT_CLOSE)", true);
                        } else {
                          // Fallback: manually add to chat
                          const chatContent = document.querySelector('#game-chat .chat-content');
                          if (chatContent) {
                            const msg = document.createElement('p');
                            const bold = document.createElement('b');
                            bold.textContent = '';
                            const span = document.createElement('span');
                            span.textContent = "Copied room link to clipboard!";
                            msg.appendChild(bold);
                            msg.appendChild(span);
                            msg.style.color = "#e2cb00";
                            chatContent.appendChild(msg);
                            const shouldScroll = chatContent.scrollHeight - chatContent.scrollTop - chatContent.clientHeight <= 20;
                            if (shouldScroll) {
                              chatContent.scrollTop = chatContent.scrollHeight + 100;
                            }
                          }
                        }
                        
                        // Copy to clipboard
                        if (navigator.clipboard) {
                          navigator.clipboard.writeText(inviteUrl).then(function() {
                          }).catch(function(err) {
                            console.error('❌ Failed to copy:', err);
                            // Fallback
                            const input = document.createElement('input');
                            input.value = inviteUrl;
                            document.body.appendChild(input);
                            input.select();
                            document.execCommand('copy');
                            document.body.removeChild(input);
                          });
                        } else {
                          // Fallback
                          const input = document.createElement('input');
                          input.value = inviteUrl;
                          document.body.appendChild(input);
                          input.select();
                          document.execCommand('copy');
                          document.body.removeChild(input);
                        }
                      }
                    }
                    
                    // Patch immediately and also after a delay to catch late-loading elements
                    patchInviteButtons();
                    setTimeout(patchInviteButtons, 500);
                    setTimeout(patchInviteButtons, 1500);
                  }
                  
                  // Let game.js handle private room display naturally (like play screen)
                  // Don't add custom styling - let it work exactly like the play screen
                }
              });
              
          return socket;
      };
    }
})();

// NO AUTO-JOIN - User should go to home screen and click Play button
// The Play button will automatically use the room code from URL (game.js handles this)
</script>
        <script src="js/game.js"></script>
    </body>
</html>
